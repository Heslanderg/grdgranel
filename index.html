
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Consulta de Rota</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
      background-color: #f9f9f9;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    header img {
      height: 50px;
    }
    h1 {
      font-size: 24px;
      margin: 0;
    }
    input[type="text"] {
      width: 300px;
      padding: 8px;
      font-size: 16px;
    }
    button {
      padding: 8px 14px;
      margin-left: 10px;
      font-size: 16px;
      cursor: pointer;
    }
    .resultado {
      margin-top: 20px;
    }
    .linha {
      border-bottom: 1px solid #ccc;
      margin: 10px 0;
      padding-bottom: 8px;
    }
    footer {
      margin-top: 40px;
      color: #666;
      font-size: 14px;
    }
  </style>
</head>
<body>

  <header>
    <img src="logo.webp" alt="Logo" />
    <h1>Consulta de Produto e Rota</h1>
  </header>

  <input type="text" id="produtoInput" placeholder="Digite o nome do produto" />
  <button onclick="buscarProduto()">Pesquisar</button>
  <button onclick="limparResultados()">Limpar Histórico</button>

  <div id="resultado" class="resultado"></div>

  <footer>Gerenciamento de Risco (v.01)</footer>

  <script>
    let dadosCSV = [];

    // Carrega o CSV ao abrir a página
    fetch('Rotas_Produtos.csv')
      .then(response => {
        if (!response.ok) throw new Error('Erro ao carregar CSV');
        return response.text();
      })
      .then(data => {
        const linhas = data.split('\n').filter(l => l.trim() !== '');
        const cabecalhos = linhas[0].split(',');
        dadosCSV = linhas.slice(1).map(linha => {
          const colunas = linha.split(',');
          return {
            valor: colunas[0]?.trim(),
            produto: colunas[1]?.trim().toLowerCase(),
            origem: colunas[2]?.trim(),
            rf_origem: colunas[3]?.trim(),
            destino: colunas[4]?.trim(),
            uf_destino: colunas[5]?.trim(),
            km: colunas[6]?.trim()
          };
        });
      })
      .catch(err => {
        document.getElementById('resultado').innerHTML = '<p style="color:red;">Erro ao carregar a planilha.</p>';
        console.error(err);
      });

    function buscarProduto() {
      const termo = document.getElementById('produtoInput').value.trim().toLowerCase();
      const resultados = dadosCSV.filter(d => d.produto.includes(termo));

      const container = document.getElementById('resultado');
      container.innerHTML = '';

      if (resultados.length === 0) {
        container.innerHTML = '<p>Nenhum produto encontrado.</p>';
        return;
      }

      resultados.forEach(r => {
        const linha = document.createElement('div');
        linha.classList.add('linha');

        // Formatar valor
        const valorNum = parseFloat(r.valor.replace(/[R$\s.]/g, '').replace(',', '.'));
        const valorFormatado = valorNum.toLocaleString('pt-BR', {
          style: 'currency',
          currency: 'BRL'
        });

        linha.innerText = `${r.produto.toUpperCase()} ${r.origem} ${r.rf_origem} X ${r.destino} ${r.uf_destino} ${r.km} KM ${valorFormatado}`;
        container.appendChild(linha);
      });
    }

    function limparResultados() {
      document.getElementById('resultado').innerHTML = '';
      document.getElementById('produtoInput').value = '';
    }
  </script>

</body>
</html>
